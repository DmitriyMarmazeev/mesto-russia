(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Tp:()=>i,kZ:()=>D,gH:()=>d,$J:()=>j,ar:()=>O});var t=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.inactiveButtonClass):t.classList.add(n.inactiveButtonClass)};function n(e){e.classList.add("popup_is-opened"),e!==d&&document.addEventListener("keydown",r)}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function r(e){"Escape"==e.key&&o(document.querySelector(".popup_is-opened"))}var c={baseUrl:"",headers:{authorization:"","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function u(e,t,o,r,u){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=i.cloneNode(!0),p=s.querySelector(".card__image"),d=s.querySelector(".card__title"),_=s.querySelector(".card__like-button"),f=s.querySelector(".card__like-count"),m=s.querySelector(".card__delete-button");return d.textContent=e,p.src=t,p.alt=e,f.textContent=l.length,l.some((function(e){return e.name===u}))&&_.classList.add("card__like-button_is-active"),_.addEventListener("click",(function(e){var t=e.target,n=t.nextElementSibling;t.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:c.headers}).then(a)}(o).then((function(e){n.textContent=e.likes.length,t.classList.remove("card__like-button_is-active")})).catch((function(e){return alert(e)})):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then(a)}(o).then((function(e){n.textContent=e.likes.length,t.classList.add("card__like-button_is-active")})).catch((function(e){return alert(e)}))})),r===u?m.addEventListener("click",(function(e){(function(e){return fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers}).then(a)})(o).then((function(){e.target.closest(".card").remove()})).catch((function(e){return alert(e)}))})):m.remove(),p.addEventListener("click",(function(){O.src=p.src,O.alt=d.textContent,j.textContent=d.textContent,n(D)})),s}var i=document.querySelector("#card-template").content,l=document.querySelector(".places__list"),s=document.querySelectorAll(".popup"),p=document.querySelectorAll(".popup__close"),d=document.querySelector(".popup_type_login"),_=d.querySelector(".popup__form"),f=d.querySelector(".popup__input_type_group"),m=d.querySelector(".popup__input_type_token"),v=d.querySelector(".button__login"),y=document.querySelector(".header__logout-button"),h=document.querySelector(".profile__image"),S=document.querySelector(".popup_type_avatar"),g=S.querySelector(".popup__form"),b=S.querySelector(".popup__input_type_avatar-link"),q=document.querySelector(".popup_type_edit"),k=document.querySelector(".profile__edit-button"),C=q.querySelector(".popup__form"),E=q.querySelector(".popup__input_type_name"),L=q.querySelector(".popup__input_type_description"),x=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),U=document.querySelector(".popup_type_new-card"),I=document.querySelector(".profile__add-button"),P=U.querySelector(".popup__form"),w=U.querySelector(".popup__input_type_card-name"),A=U.querySelector(".popup__input_type_url"),D=document.querySelector(".popup_type_image"),O=D.querySelector(".popup__image"),j=D.querySelector(".popup__caption"),B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function J(e,t){(function(e,t){return fetch("".concat(e,"/users/me"),{method:"GET",headers:{authorization:t}}).then((function(n){return n.ok?(c.baseUrl=e,c.headers.authorization=t,Promise.resolve("Успешно: ".concat(n.status))):Promise.reject("Ошибка: ".concat(n.status))}))})(e,t).then((function(){!function(e,t){localStorage.setItem("token",e),localStorage.setItem("group",t)}(t,e),fetch("".concat(c.baseUrl,"/users/me"),{method:"GET",headers:c.headers}).then(a).then((function(e){o(d),x.textContent=e.name,T.textContent=e.about,h.style.backgroundImage="url(".concat(e.avatar,")"),fetch("".concat(c.baseUrl,"/cards"),{method:"GET",headers:c.headers}).then(a).then((function(t){t.forEach((function(t){l.append(u(t.name,t.link,t._id,t.owner.name,e.name,t.likes))}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))})).catch((function(e){f.value="",m.value="",console.log(e)})).finally((function(){v.textContent="Войти"}))}function N(e){e.preventDefault(),v.textContent="Выполняется вход...",J(f.value,m.value)}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),r=e.querySelector(n.submitButtonSelector);t(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,n),t(o,r,n)}))}))}(n,e)}))}(B),h.addEventListener("click",(function(){b.value=h.style.backgroundImage.slice(5,-2),n(S)})),g.addEventListener("submit",(function(e){e.preventDefault();var t,n=e.target.querySelector(".popup__button"),r=b.value;n.textContent="Сохранение...",(t=r,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t})}).then(a)).then((function(e){h.style.backgroundImage="url(".concat(e.avatar,")"),o(S)})).catch((function(e){return console.log(e)})).finally((function(){n.textContent="Сохранить"}))})),k.addEventListener("click",(function(){E.value=x.textContent,L.value=T.textContent,n(q)})),C.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=e.target.querySelector(".popup__button");r.textContent="Сохранение...",(t=E.value,n=L.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:n})}).then(a)).then((function(e){x.textContent=e.name,T.textContent=e.about,o(q)})).catch((function(e){return console.log(e)})).finally((function(){r.textContent="Сохранить"}))})),I.addEventListener("click",(function(){w.value="",A.value="",n(U)})),P.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=e.target.querySelector(".popup__button");r.textContent="Создание...",(t=w.value,n=A.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:t,link:n})}).then(a)).then((function(e){l.prepend(u(e.name,e.link,e._id,e.owner.name,e.owner.name)),o(U)})).catch((function(e){return console.log(e)})).finally((function(){r.textContent="Создать"}))})),_.addEventListener("submit",N),y.addEventListener("click",(function(){localStorage.removeItem("token"),localStorage.removeItem("group"),location.reload()})),s.forEach((function(e){e.classList.add("popup_is-animated"),e!==d&&e.addEventListener("mousedown",(function(t){t.target.closest(".popup__content")||o(e)}))})),p.forEach((function(e){e.addEventListener("click",(function(){return o(e.closest(".popup"))}))})),document.addEventListener("DOMContentLoaded",(function(){var e={token:localStorage.getItem("token"),group:localStorage.getItem("group")},t=e.token,n=e.group;t&&n&&(_.removeEventListener("submit",N),f.value=n,m.value=t,v.classList.remove(B.inactiveButtonClass),v.textContent="Выполняется вход...",J(n,t))}))})();